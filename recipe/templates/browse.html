{% extends "base.html" %}
{% block title %}Browse{% endblock %}
{% block content %}
    <div class="heading-cont">
        <h2>{{ "MY FAVOURITES" if mode == "favourites" else "BROWSE RECIPES!" }}</h2>

        <form method="GET"
              action="{{ url_for('browse_bp.favourites') if mode == 'favourites' else url_for('browse_bp.browse') }}"
              class="search-bar">
            <select name="filter_by">
                <option value="name" {% if filter_by == 'name' %}selected{% endif %}>Recipe Name</option>
                <option value="category" {% if filter_by == 'category' %}selected{% endif %}>Category</option>
                <option value="author" {% if filter_by == 'author' %}selected{% endif %}>Author</option>
                <option value="ingredient" {% if filter_by == 'ingredient' %}selected{% endif %}>Ingredient</option>
            </select>

            <input type="text" name="query" placeholder="Search recipes..." value="{{ query or '' }}" required />

            <button type="submit">Search</button>
        </form>
    </div>

    <div class="recipes-cont">
        {% for recipe in recipes %}
            <div class="browse-card" id="card-{{ recipe.id }}" onclick="location.href='{{ url_for('recipe_bp.recipe', recipe_id=recipe.id) }}{% if mode == 'favourites' %}?from=favourites{% endif %}'">
                <div class="browse-card-cont">
                    <img src="{{ recipe.images[0] }}" alt="recipe-image">
                </div>
                <h1>{{ recipe.name }}</h1>
                <p>{{ recipe.description }}</p>

                {% if session.get('user_name') %}
                    <form method="POST" action="{{ url_for('browse_bp.toggle_favourite_recipe', recipe_id=recipe.id) }}" class="card-fav-form">
                        {# prefer an explicit 'next' path so server can redirect back exactly where we are #}
                        <input type="hidden" name="next" value="{{ request.full_path }}" />
                        <button type="submit" class="card-fav-btn{% if recipe.is_favourite %} favourited{% endif %}" aria-label="Toggle favourite" data-card-id="card-{{ recipe.id }}">
                            <span class="heart-icon">{{ '♥' if recipe.is_favourite else '♡' }}</span>
                        </button>
                    </form>
                {% endif %}
            </div>
        {% endfor %}
    </div>

    <div class="pagination">
        {% if first_recipe_url %}
            <a href="{{ first_recipe_url }}">&laquo;</a> <!-- Double Left -->
        {% endif %}
        {% if prev_recipe_url %}
            <a href="{{ prev_recipe_url }}">&lt;</a> <!-- Single Left -->
        {% endif %}
        {% if next_recipe_url %}
            <a href="{{ next_recipe_url }}">&gt;</a> <!-- Single Right -->
        {% endif %}
        {% if last_recipe_url %}
            <a href="{{ last_recipe_url }}">&raquo;</a> <!-- Double Right -->
        {% endif %}
    </div>


{% endblock %}